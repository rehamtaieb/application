---
- hosts: k8s_worker
  become: yes
  tasks:
    - name: Install Docker
      apt:
        name: docker.io
        state: present

    - name: Install Kubernetes
      apt:
        name: ['kubelet', 'kubeadm', 'kubectl']
        state: present

- hosts: k8s_master
  become: yes
  tasks:
    - name: Generate join command
      command: kubeadm token create --print-join-command
      register: join_command

- hosts: k8s_worker
  become: yes
  tasks:
    - name: Join the cluster
      command: "{{ hostvars['k8s_master']['join_command']['stdout'] }}"
